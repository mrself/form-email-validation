(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
window.EmailValiditon = require('../index.js');
},{"../index.js":2}],2:[function(require,module,exports){
(function (global){
function EmailValiditon() {
	/**
	 * Form containing $field
	 * @type {jQuery|undefined}
	 */
	this.$form = undefined;

	/**
	 * Email field
	 * @type {jQuery|undefined}
	 */
	this.$field = undefined;

	/**
	 * If plugin was inited on $field
	 * @type {Boolean}
	 */
	this.isInited = false;

	/**
	 * If form could be proceeded
	 * @type {Boolean}
	 */
	this.formEnabled = true;

	/**
	 * Current email
	 * @type {string}
	 */
	this.value = undefined;

	/**
	 * Last validated email
	 * @type {string}
	 */
	this.previousValue = undefined;
}

EmailValiditon.prototype = {
	constructor: EmailValiditon,

	init: function() {
		if (this.isInited || !this.defineForm() || !this.defineSubmitBtn()) return;
		this.setEvents();
		this.dName = this.options.dName;
		this.$field.addClass(this.dName);
		this.setIsInited();
	},

	/**
	 * Set that a plugin is fully inited.
	 */
	setIsInited: function() {
		this.isInited = true;
		this.$field.addClass(this.dName + '--inited');
	},

	/**
	 * Define and set $sbmit in $form
	 * @return {boolean} If $submit exists
	 */
	defineSubmitBtn: function() {
		this.$submit = this.$form.find('[type="submit"]');
		return !!this.$submit.length;
	},

	/**
	 * Define and set $form
	 * @return {boolean} If $form exists
	 */
	defineForm: function() {
		this.$form = this.$field.closest('form');
		return !!this.$form.length;
	},

	setEvents: function() {
		if (~this.options.triggerType.indexOf('focusout'))
			this.initBlurTrigger();
		this.$form.on('submit', this.onSubmit.bind(this));
	},

	initBlurTrigger: function() {
		var timeoutFlag, self = this;
		this.$field.on('blur', function() {
			timeoutFlag = setTimeout(self.run.bind(self), self.options.focusoutDelay);
		}).on('focus', function() {
			clearTimeout(timeoutFlag);
		});
	},

	/**
	 * Called on form submit.
	 * Prevent default form proceeding if an email is invalid
	 * @return {boolean|void}
	 */
	onSubmit: function() {
		if (!this.isStateSetted()) this.run();
		if (!this.formEnabled)
			return false;
	},

	/**
	 * If state was given any value. 
	 * Return 'false' only if user submit form without focus the $field
	 * @return {Boolean}
	 */
	isStateSetted: function() {
		return 'state' in this;
	},

	/**
	 * Execute pre-validation, validation and post-validtion things
	 */
	run: function() {
		if (!this.isValueChanged()) return;
		if (this.isHashed())
			return this.setHashedState();
		var self = this;
		this.state = EmailValiditon.STATES.PENDING;
		this.validate(this.value).done(function(result) {
			EmailValiditon.setHash(self.value, result);
			self.setState(result);
		});
	},

	/**
	 * Set hashed value of state
	 */
	setHashedState: function() {
		var hashed = EmailValiditon.getHash(this.value);
		this.setState(hashed);
	},

	/**
	 * If validation of valued was hashed
	 * @return {Boolean}
	 */
	isHashed: function() {
		return this.options.hash && EmailValiditon.hasHash(this.value);
	},

	isValueChanged: function() {
		this.value = this.$field.val();
		if (this.previousValue == this.value) return false;
		this.previousValue = this.value;
		return true;
	},

	/**
	 * Set state
	 * @param {boolean|null|undefined} state 
	 */
	setState: function(state) {
		if (state === EmailValiditon.STATES.INVALID) {
			this.setInValid();
		} else if (state === EmailValiditon.STATES.VALID || 
			state === EmailValiditon.STATES.UNDEFINED)
			this.setValid();
		else if (state == EmailValiditon.STATES.UNDEFINED)
			this.reset();
		else {
			state = EmailValiditon.STATES.UNDEFINED;
			this.state = state;
			throw new Error('Not allowed value of state');
		}
	},

	/**
	 * Reset form and field to default value as they were before plugin init
	 */
	reset: function() {
		this.formEnabled = true;
		this.$submit.removeClass(this.dName + 'Submit--disabled').prop('disabled', false);
		this.$field
			.removeClass(this.dName + '--valid')
			.removeClass(this.dName + '--invalid');
	},

	/**
	 * Called when email is invalid.
	 * Disable form. Mark field as invalid
	 */
	setInValid: function() {
		this.formEnabled = false;
		this.$submit.addClass(this.dName + 'Submit--disabled').prop('disabled', true);
		this.$field
			.removeClass(this.dName + '--valid')
			.addClass(this.dName + '--invalid');
	},

	/**
	 * Called when email is valid.
	 * Enable form. Mark field as valid
	 */
	setValid: function() {
		this.formEnabled = true;
		this.$submit.removeClass(this.dName + 'Submit--disabled').prop('disabled', false);
		this.$field.removeClass(this.dName + '--invalid').addClass(this.dName + '--valid');
	},

	/**
	 * Validate email
	 * @param  {string} email Email to validate
	 * @return {jQuery.Deferred} Deferred instance, which is resolved with a state
	 */
	validate: function(email) {
		var result = this.validateRegExp(email);
		if (result && this.options.remoteValidate)
			return this.options.remoteValidate(email);
		var def = $.Deferred();
		def.resolve(result);
		return def;
	},

	/**
	 * Validate an email with regular expression
	 * @param  {string} email Email to validate
	 * @return {boolean}      Result of validation
	 */
	validateRegExp: function(email) {
		return this.options.validationReg.test(email);
	},

	/**
	 * Set options, extending existing
	 * @param {Object} options New options
	 */
	setOptions: function(options) {
		this.options = $.extend(true, this.options, EmailValiditon.options, options);
		this.options.triggerType = [].concat(this.options.triggerType);
	},
};

EmailValiditon.STATES = {
	// State can not be detected. It happens when #remoteValidation produces an error
	UNDEFINED: undefined,
	// State is valid
	VALID: true,
	// State is invalid
	INVALID: false,
	PENDING: null
};

/**
 * Init plugin on $field with options
 * @param  {jQuery} $field  Email field
 * @param  {Object} [options] Options
 * @return {EmailValiditon]   Instance
 */
EmailValiditon.initField = function($field, options) {
	var inst = new this;
	inst.$field = $field;
	inst.setOptions(options);
	inst.init();
	return inst;
};

/**
 * Init plugin on document name (class name) with options
 * @param  {string} dName   
 * @param  {object} [options] 
 */
EmailValiditon.initSelector = function(dName, options) {
	options = options || {};
	options.dName = dName;
	$('.' + dName).each(function() {
		var inst = new EmailValiditon;
		inst.$field = $(this);
		inst.setOptions(options);
		inst.init();
	});
};

EmailValiditon.options = {
	dName: 'femm',
	validationReg: /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i,
	triggerType: ['focusout'/*,'keyup'*/],
	remoteValidate: false,
	// Used only when `triggerType` contains 'focusout'
	focusoutDelay: 400,
	// If hash results
	hash: true
};
EmailValiditon.setOptions = function(options) {
	this.options = $.extend(true, this.options, options);
};

EmailValiditon.hash = {};
EmailValiditon.getHash = function(key) {
	return this.hash[key];
};
EmailValiditon.setHash = function(key, value) {
	this.hash[key] = value;
};
EmailValiditon.hasHash = function(key) {
	return key in this.hash;
};
EmailValiditon.clearHash = function() {
	this.hash = {};
};

module.exports = EmailValiditon;

global.l = function (x) {
	console.log(x);
};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJicm93c2VyLXRlc3QvaW5kZXguanMiLCJpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBOzs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwid2luZG93LkVtYWlsVmFsaWRpdG9uID0gcmVxdWlyZSgnLi4vaW5kZXguanMnKTsiLCJmdW5jdGlvbiBFbWFpbFZhbGlkaXRvbigpIHtcclxuXHQvKipcclxuXHQgKiBGb3JtIGNvbnRhaW5pbmcgJGZpZWxkXHJcblx0ICogQHR5cGUge2pRdWVyeXx1bmRlZmluZWR9XHJcblx0ICovXHJcblx0dGhpcy4kZm9ybSA9IHVuZGVmaW5lZDtcclxuXHJcblx0LyoqXHJcblx0ICogRW1haWwgZmllbGRcclxuXHQgKiBAdHlwZSB7alF1ZXJ5fHVuZGVmaW5lZH1cclxuXHQgKi9cclxuXHR0aGlzLiRmaWVsZCA9IHVuZGVmaW5lZDtcclxuXHJcblx0LyoqXHJcblx0ICogSWYgcGx1Z2luIHdhcyBpbml0ZWQgb24gJGZpZWxkXHJcblx0ICogQHR5cGUge0Jvb2xlYW59XHJcblx0ICovXHJcblx0dGhpcy5pc0luaXRlZCA9IGZhbHNlO1xyXG5cclxuXHQvKipcclxuXHQgKiBJZiBmb3JtIGNvdWxkIGJlIHByb2NlZWRlZFxyXG5cdCAqIEB0eXBlIHtCb29sZWFufVxyXG5cdCAqL1xyXG5cdHRoaXMuZm9ybUVuYWJsZWQgPSB0cnVlO1xyXG5cclxuXHQvKipcclxuXHQgKiBDdXJyZW50IGVtYWlsXHJcblx0ICogQHR5cGUge3N0cmluZ31cclxuXHQgKi9cclxuXHR0aGlzLnZhbHVlID0gdW5kZWZpbmVkO1xyXG5cclxuXHQvKipcclxuXHQgKiBMYXN0IHZhbGlkYXRlZCBlbWFpbFxyXG5cdCAqIEB0eXBlIHtzdHJpbmd9XHJcblx0ICovXHJcblx0dGhpcy5wcmV2aW91c1ZhbHVlID0gdW5kZWZpbmVkO1xyXG59XHJcblxyXG5FbWFpbFZhbGlkaXRvbi5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEVtYWlsVmFsaWRpdG9uLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLmlzSW5pdGVkIHx8ICF0aGlzLmRlZmluZUZvcm0oKSB8fCAhdGhpcy5kZWZpbmVTdWJtaXRCdG4oKSkgcmV0dXJuO1xyXG5cdFx0dGhpcy5zZXRFdmVudHMoKTtcclxuXHRcdHRoaXMuZE5hbWUgPSB0aGlzLm9wdGlvbnMuZE5hbWU7XHJcblx0XHR0aGlzLiRmaWVsZC5hZGRDbGFzcyh0aGlzLmROYW1lKTtcclxuXHRcdHRoaXMuc2V0SXNJbml0ZWQoKTtcclxuXHR9LFxyXG5cclxuXHQvKipcclxuXHQgKiBTZXQgdGhhdCBhIHBsdWdpbiBpcyBmdWxseSBpbml0ZWQuXHJcblx0ICovXHJcblx0c2V0SXNJbml0ZWQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5pc0luaXRlZCA9IHRydWU7XHJcblx0XHR0aGlzLiRmaWVsZC5hZGRDbGFzcyh0aGlzLmROYW1lICsgJy0taW5pdGVkJyk7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogRGVmaW5lIGFuZCBzZXQgJHNibWl0IGluICRmb3JtXHJcblx0ICogQHJldHVybiB7Ym9vbGVhbn0gSWYgJHN1Ym1pdCBleGlzdHNcclxuXHQgKi9cclxuXHRkZWZpbmVTdWJtaXRCdG46IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy4kc3VibWl0ID0gdGhpcy4kZm9ybS5maW5kKCdbdHlwZT1cInN1Ym1pdFwiXScpO1xyXG5cdFx0cmV0dXJuICEhdGhpcy4kc3VibWl0Lmxlbmd0aDtcclxuXHR9LFxyXG5cclxuXHQvKipcclxuXHQgKiBEZWZpbmUgYW5kIHNldCAkZm9ybVxyXG5cdCAqIEByZXR1cm4ge2Jvb2xlYW59IElmICRmb3JtIGV4aXN0c1xyXG5cdCAqL1xyXG5cdGRlZmluZUZvcm06IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy4kZm9ybSA9IHRoaXMuJGZpZWxkLmNsb3Nlc3QoJ2Zvcm0nKTtcclxuXHRcdHJldHVybiAhIXRoaXMuJGZvcm0ubGVuZ3RoO1xyXG5cdH0sXHJcblxyXG5cdHNldEV2ZW50czogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAofnRoaXMub3B0aW9ucy50cmlnZ2VyVHlwZS5pbmRleE9mKCdmb2N1c291dCcpKVxyXG5cdFx0XHR0aGlzLmluaXRCbHVyVHJpZ2dlcigpO1xyXG5cdFx0dGhpcy4kZm9ybS5vbignc3VibWl0JywgdGhpcy5vblN1Ym1pdC5iaW5kKHRoaXMpKTtcclxuXHR9LFxyXG5cclxuXHRpbml0Qmx1clRyaWdnZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRpbWVvdXRGbGFnLCBzZWxmID0gdGhpcztcclxuXHRcdHRoaXMuJGZpZWxkLm9uKCdibHVyJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdHRpbWVvdXRGbGFnID0gc2V0VGltZW91dChzZWxmLnJ1bi5iaW5kKHNlbGYpLCBzZWxmLm9wdGlvbnMuZm9jdXNvdXREZWxheSk7XHJcblx0XHR9KS5vbignZm9jdXMnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXRGbGFnKTtcclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdC8qKlxyXG5cdCAqIENhbGxlZCBvbiBmb3JtIHN1Ym1pdC5cclxuXHQgKiBQcmV2ZW50IGRlZmF1bHQgZm9ybSBwcm9jZWVkaW5nIGlmIGFuIGVtYWlsIGlzIGludmFsaWRcclxuXHQgKiBAcmV0dXJuIHtib29sZWFufHZvaWR9XHJcblx0ICovXHJcblx0b25TdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKCF0aGlzLmlzU3RhdGVTZXR0ZWQoKSkgdGhpcy5ydW4oKTtcclxuXHRcdGlmICghdGhpcy5mb3JtRW5hYmxlZClcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdC8qKlxyXG5cdCAqIElmIHN0YXRlIHdhcyBnaXZlbiBhbnkgdmFsdWUuIFxyXG5cdCAqIFJldHVybiAnZmFsc2UnIG9ubHkgaWYgdXNlciBzdWJtaXQgZm9ybSB3aXRob3V0IGZvY3VzIHRoZSAkZmllbGRcclxuXHQgKiBAcmV0dXJuIHtCb29sZWFufVxyXG5cdCAqL1xyXG5cdGlzU3RhdGVTZXR0ZWQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuICdzdGF0ZScgaW4gdGhpcztcclxuXHR9LFxyXG5cclxuXHQvKipcclxuXHQgKiBFeGVjdXRlIHByZS12YWxpZGF0aW9uLCB2YWxpZGF0aW9uIGFuZCBwb3N0LXZhbGlkdGlvbiB0aGluZ3NcclxuXHQgKi9cclxuXHRydW46IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKCF0aGlzLmlzVmFsdWVDaGFuZ2VkKCkpIHJldHVybjtcclxuXHRcdGlmICh0aGlzLmlzSGFzaGVkKCkpXHJcblx0XHRcdHJldHVybiB0aGlzLnNldEhhc2hlZFN0YXRlKCk7XHJcblx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHR0aGlzLnN0YXRlID0gRW1haWxWYWxpZGl0b24uU1RBVEVTLlBFTkRJTkc7XHJcblx0XHR0aGlzLnZhbGlkYXRlKHRoaXMudmFsdWUpLmRvbmUoZnVuY3Rpb24ocmVzdWx0KSB7XHJcblx0XHRcdEVtYWlsVmFsaWRpdG9uLnNldEhhc2goc2VsZi52YWx1ZSwgcmVzdWx0KTtcclxuXHRcdFx0c2VsZi5zZXRTdGF0ZShyZXN1bHQpO1xyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogU2V0IGhhc2hlZCB2YWx1ZSBvZiBzdGF0ZVxyXG5cdCAqL1xyXG5cdHNldEhhc2hlZFN0YXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBoYXNoZWQgPSBFbWFpbFZhbGlkaXRvbi5nZXRIYXNoKHRoaXMudmFsdWUpO1xyXG5cdFx0dGhpcy5zZXRTdGF0ZShoYXNoZWQpO1xyXG5cdH0sXHJcblxyXG5cdC8qKlxyXG5cdCAqIElmIHZhbGlkYXRpb24gb2YgdmFsdWVkIHdhcyBoYXNoZWRcclxuXHQgKiBAcmV0dXJuIHtCb29sZWFufVxyXG5cdCAqL1xyXG5cdGlzSGFzaGVkOiBmdW5jdGlvbigpIHtcclxuXHRcdHJldHVybiB0aGlzLm9wdGlvbnMuaGFzaCAmJiBFbWFpbFZhbGlkaXRvbi5oYXNIYXNoKHRoaXMudmFsdWUpO1xyXG5cdH0sXHJcblxyXG5cdGlzVmFsdWVDaGFuZ2VkOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMudmFsdWUgPSB0aGlzLiRmaWVsZC52YWwoKTtcclxuXHRcdGlmICh0aGlzLnByZXZpb3VzVmFsdWUgPT0gdGhpcy52YWx1ZSkgcmV0dXJuIGZhbHNlO1xyXG5cdFx0dGhpcy5wcmV2aW91c1ZhbHVlID0gdGhpcy52YWx1ZTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdC8qKlxyXG5cdCAqIFNldCBzdGF0ZVxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbnxudWxsfHVuZGVmaW5lZH0gc3RhdGUgXHJcblx0ICovXHJcblx0c2V0U3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7XHJcblx0XHRpZiAoc3RhdGUgPT09IEVtYWlsVmFsaWRpdG9uLlNUQVRFUy5JTlZBTElEKSB7XHJcblx0XHRcdHRoaXMuc2V0SW5WYWxpZCgpO1xyXG5cdFx0fSBlbHNlIGlmIChzdGF0ZSA9PT0gRW1haWxWYWxpZGl0b24uU1RBVEVTLlZBTElEIHx8IFxyXG5cdFx0XHRzdGF0ZSA9PT0gRW1haWxWYWxpZGl0b24uU1RBVEVTLlVOREVGSU5FRClcclxuXHRcdFx0dGhpcy5zZXRWYWxpZCgpO1xyXG5cdFx0ZWxzZSBpZiAoc3RhdGUgPT0gRW1haWxWYWxpZGl0b24uU1RBVEVTLlVOREVGSU5FRClcclxuXHRcdFx0dGhpcy5yZXNldCgpO1xyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHN0YXRlID0gRW1haWxWYWxpZGl0b24uU1RBVEVTLlVOREVGSU5FRDtcclxuXHRcdFx0dGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ05vdCBhbGxvd2VkIHZhbHVlIG9mIHN0YXRlJyk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogUmVzZXQgZm9ybSBhbmQgZmllbGQgdG8gZGVmYXVsdCB2YWx1ZSBhcyB0aGV5IHdlcmUgYmVmb3JlIHBsdWdpbiBpbml0XHJcblx0ICovXHJcblx0cmVzZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5mb3JtRW5hYmxlZCA9IHRydWU7XHJcblx0XHR0aGlzLiRzdWJtaXQucmVtb3ZlQ2xhc3ModGhpcy5kTmFtZSArICdTdWJtaXQtLWRpc2FibGVkJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XHJcblx0XHR0aGlzLiRmaWVsZFxyXG5cdFx0XHQucmVtb3ZlQ2xhc3ModGhpcy5kTmFtZSArICctLXZhbGlkJylcclxuXHRcdFx0LnJlbW92ZUNsYXNzKHRoaXMuZE5hbWUgKyAnLS1pbnZhbGlkJyk7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogQ2FsbGVkIHdoZW4gZW1haWwgaXMgaW52YWxpZC5cclxuXHQgKiBEaXNhYmxlIGZvcm0uIE1hcmsgZmllbGQgYXMgaW52YWxpZFxyXG5cdCAqL1xyXG5cdHNldEluVmFsaWQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5mb3JtRW5hYmxlZCA9IGZhbHNlO1xyXG5cdFx0dGhpcy4kc3VibWl0LmFkZENsYXNzKHRoaXMuZE5hbWUgKyAnU3VibWl0LS1kaXNhYmxlZCcpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XHJcblx0XHR0aGlzLiRmaWVsZFxyXG5cdFx0XHQucmVtb3ZlQ2xhc3ModGhpcy5kTmFtZSArICctLXZhbGlkJylcclxuXHRcdFx0LmFkZENsYXNzKHRoaXMuZE5hbWUgKyAnLS1pbnZhbGlkJyk7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogQ2FsbGVkIHdoZW4gZW1haWwgaXMgdmFsaWQuXHJcblx0ICogRW5hYmxlIGZvcm0uIE1hcmsgZmllbGQgYXMgdmFsaWRcclxuXHQgKi9cclxuXHRzZXRWYWxpZDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmZvcm1FbmFibGVkID0gdHJ1ZTtcclxuXHRcdHRoaXMuJHN1Ym1pdC5yZW1vdmVDbGFzcyh0aGlzLmROYW1lICsgJ1N1Ym1pdC0tZGlzYWJsZWQnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcclxuXHRcdHRoaXMuJGZpZWxkLnJlbW92ZUNsYXNzKHRoaXMuZE5hbWUgKyAnLS1pbnZhbGlkJykuYWRkQ2xhc3ModGhpcy5kTmFtZSArICctLXZhbGlkJyk7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogVmFsaWRhdGUgZW1haWxcclxuXHQgKiBAcGFyYW0gIHtzdHJpbmd9IGVtYWlsIEVtYWlsIHRvIHZhbGlkYXRlXHJcblx0ICogQHJldHVybiB7alF1ZXJ5LkRlZmVycmVkfSBEZWZlcnJlZCBpbnN0YW5jZSwgd2hpY2ggaXMgcmVzb2x2ZWQgd2l0aCBhIHN0YXRlXHJcblx0ICovXHJcblx0dmFsaWRhdGU6IGZ1bmN0aW9uKGVtYWlsKSB7XHJcblx0XHR2YXIgcmVzdWx0ID0gdGhpcy52YWxpZGF0ZVJlZ0V4cChlbWFpbCk7XHJcblx0XHRpZiAocmVzdWx0ICYmIHRoaXMub3B0aW9ucy5yZW1vdGVWYWxpZGF0ZSlcclxuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9ucy5yZW1vdGVWYWxpZGF0ZShlbWFpbCk7XHJcblx0XHR2YXIgZGVmID0gJC5EZWZlcnJlZCgpO1xyXG5cdFx0ZGVmLnJlc29sdmUocmVzdWx0KTtcclxuXHRcdHJldHVybiBkZWY7XHJcblx0fSxcclxuXHJcblx0LyoqXHJcblx0ICogVmFsaWRhdGUgYW4gZW1haWwgd2l0aCByZWd1bGFyIGV4cHJlc3Npb25cclxuXHQgKiBAcGFyYW0gIHtzdHJpbmd9IGVtYWlsIEVtYWlsIHRvIHZhbGlkYXRlXHJcblx0ICogQHJldHVybiB7Ym9vbGVhbn0gICAgICBSZXN1bHQgb2YgdmFsaWRhdGlvblxyXG5cdCAqL1xyXG5cdHZhbGlkYXRlUmVnRXhwOiBmdW5jdGlvbihlbWFpbCkge1xyXG5cdFx0cmV0dXJuIHRoaXMub3B0aW9ucy52YWxpZGF0aW9uUmVnLnRlc3QoZW1haWwpO1xyXG5cdH0sXHJcblxyXG5cdC8qKlxyXG5cdCAqIFNldCBvcHRpb25zLCBleHRlbmRpbmcgZXhpc3RpbmdcclxuXHQgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBOZXcgb3B0aW9uc1xyXG5cdCAqL1xyXG5cdHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRcdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHRoaXMub3B0aW9ucywgRW1haWxWYWxpZGl0b24ub3B0aW9ucywgb3B0aW9ucyk7XHJcblx0XHR0aGlzLm9wdGlvbnMudHJpZ2dlclR5cGUgPSBbXS5jb25jYXQodGhpcy5vcHRpb25zLnRyaWdnZXJUeXBlKTtcclxuXHR9LFxyXG59O1xyXG5cclxuRW1haWxWYWxpZGl0b24uU1RBVEVTID0ge1xyXG5cdC8vIFN0YXRlIGNhbiBub3QgYmUgZGV0ZWN0ZWQuIEl0IGhhcHBlbnMgd2hlbiAjcmVtb3RlVmFsaWRhdGlvbiBwcm9kdWNlcyBhbiBlcnJvclxyXG5cdFVOREVGSU5FRDogdW5kZWZpbmVkLFxyXG5cdC8vIFN0YXRlIGlzIHZhbGlkXHJcblx0VkFMSUQ6IHRydWUsXHJcblx0Ly8gU3RhdGUgaXMgaW52YWxpZFxyXG5cdElOVkFMSUQ6IGZhbHNlLFxyXG5cdFBFTkRJTkc6IG51bGxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBJbml0IHBsdWdpbiBvbiAkZmllbGQgd2l0aCBvcHRpb25zXHJcbiAqIEBwYXJhbSAge2pRdWVyeX0gJGZpZWxkICBFbWFpbCBmaWVsZFxyXG4gKiBAcGFyYW0gIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zXHJcbiAqIEByZXR1cm4ge0VtYWlsVmFsaWRpdG9uXSAgIEluc3RhbmNlXHJcbiAqL1xyXG5FbWFpbFZhbGlkaXRvbi5pbml0RmllbGQgPSBmdW5jdGlvbigkZmllbGQsIG9wdGlvbnMpIHtcclxuXHR2YXIgaW5zdCA9IG5ldyB0aGlzO1xyXG5cdGluc3QuJGZpZWxkID0gJGZpZWxkO1xyXG5cdGluc3Quc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuXHRpbnN0LmluaXQoKTtcclxuXHRyZXR1cm4gaW5zdDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBJbml0IHBsdWdpbiBvbiBkb2N1bWVudCBuYW1lIChjbGFzcyBuYW1lKSB3aXRoIG9wdGlvbnNcclxuICogQHBhcmFtICB7c3RyaW5nfSBkTmFtZSAgIFxyXG4gKiBAcGFyYW0gIHtvYmplY3R9IFtvcHRpb25zXSBcclxuICovXHJcbkVtYWlsVmFsaWRpdG9uLmluaXRTZWxlY3RvciA9IGZ1bmN0aW9uKGROYW1lLCBvcHRpb25zKSB7XHJcblx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblx0b3B0aW9ucy5kTmFtZSA9IGROYW1lO1xyXG5cdCQoJy4nICsgZE5hbWUpLmVhY2goZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgaW5zdCA9IG5ldyBFbWFpbFZhbGlkaXRvbjtcclxuXHRcdGluc3QuJGZpZWxkID0gJCh0aGlzKTtcclxuXHRcdGluc3Quc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuXHRcdGluc3QuaW5pdCgpO1xyXG5cdH0pO1xyXG59O1xyXG5cclxuRW1haWxWYWxpZGl0b24ub3B0aW9ucyA9IHtcclxuXHRkTmFtZTogJ2ZlbW0nLFxyXG5cdHZhbGlkYXRpb25SZWc6IC9eKChbXjw+KClbXFxdXFxcXC4sOzpcXHNAXFxcIl0rKFxcLltePD4oKVtcXF1cXFxcLiw7Olxcc0BcXFwiXSspKil8KFxcXCIuK1xcXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXF0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvaSxcclxuXHR0cmlnZ2VyVHlwZTogWydmb2N1c291dCcvKiwna2V5dXAnKi9dLFxyXG5cdHJlbW90ZVZhbGlkYXRlOiBmYWxzZSxcclxuXHQvLyBVc2VkIG9ubHkgd2hlbiBgdHJpZ2dlclR5cGVgIGNvbnRhaW5zICdmb2N1c291dCdcclxuXHRmb2N1c291dERlbGF5OiA0MDAsXHJcblx0Ly8gSWYgaGFzaCByZXN1bHRzXHJcblx0aGFzaDogdHJ1ZVxyXG59O1xyXG5FbWFpbFZhbGlkaXRvbi5zZXRPcHRpb25zID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XHJcbn07XHJcblxyXG5FbWFpbFZhbGlkaXRvbi5oYXNoID0ge307XHJcbkVtYWlsVmFsaWRpdG9uLmdldEhhc2ggPSBmdW5jdGlvbihrZXkpIHtcclxuXHRyZXR1cm4gdGhpcy5oYXNoW2tleV07XHJcbn07XHJcbkVtYWlsVmFsaWRpdG9uLnNldEhhc2ggPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XHJcblx0dGhpcy5oYXNoW2tleV0gPSB2YWx1ZTtcclxufTtcclxuRW1haWxWYWxpZGl0b24uaGFzSGFzaCA9IGZ1bmN0aW9uKGtleSkge1xyXG5cdHJldHVybiBrZXkgaW4gdGhpcy5oYXNoO1xyXG59O1xyXG5FbWFpbFZhbGlkaXRvbi5jbGVhckhhc2ggPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLmhhc2ggPSB7fTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRW1haWxWYWxpZGl0b247XHJcblxyXG5nbG9iYWwubCA9IGZ1bmN0aW9uICh4KSB7XHJcblx0Y29uc29sZS5sb2coeCk7XHJcbn07Il19
